library(tidyverse)
library(cowplot)
#| code-fold: true
OD_time_info <- read_csv(
"growthcurvedata/checkerboard_PB9_amp_EP6_250219_input.csv",
show_col_types = F)
head(OD_time_info, 3)
names(OD_time_info)  #there are time, temperature, and well columns
head(OD_time_info$Time)  #Time column: time is given as hours:minutes:seconds
min(OD_time_info$Time) #starts at 22 seconds
max(OD_time_info$Time / 3600) #ends at 24h and 22s
#Note: the times are in time differences and not numeric.
length(OD_time_info$Time) #49 time readings (every 30min for 24h) as expected.
#| code-fold: true
makenewtime <- function(df){
df <- mutate(df, newtime = (as.numeric(df$Time) - df$Time[1]) / 3600)
df$newtime <- as.numeric(df$newtime)  #recognized as a number, not a time in seconds
return(df)
#subtract the seconds because this will change slightly from plate to plate, depending on  how long the plate is shaken for (15 or 20s). Also divide by 3600s/h
}
OD_time_info <- makenewtime(OD_time_info) #column added
print(OD_time_info$newtime)   #looks good.
class(OD_time_info$newtime)
#| code-fold: true
OD_time_info <- OD_time_info[,-2]  #removing Temp column from data
#| code-fold: true
OD_time_info[,2:ncol(OD_time_info)] %>% head(3) #each column contains an OD600 reading
#| code-fold: true
checklength_and_NAs <- function(df){
for (i in 2:97){
#checking 49 readings
if (as.numeric(nrow(df[,i]) != 49)){
print(paste(
"length of column", names(df[i]), "is not 49, it's", nrow(df[,i])))
}
#checking NAs
if (sum(is.na(df[,i])) != 0){
print(paste("column", names(df[i]), "has", sum(is.na(df[,i])), "NAs"))
}
}
}
checklength_and_NAs(OD_time_info)
#if nothing prints there are no problems.
#| code-fold: true
#convert to long format
pivotlong_gc <- function(df){
df <- pivot_longer(df, cols = A1:H12,
names_to = "well",
values_to = "OD600")
print(df %>% head(3))
print(paste("nrow: ", nrow(df)))  #this is good because 96 * 49 = 4704
return(df)
}
long_OD_time_info <- pivotlong_gc(OD_time_info)
#| code-fold: true
distributionOD <- function(df, title){
plot <- df %>%
ggplot(aes(x = OD600)) +
geom_histogram(fill = "#043927", bins = 40) +
labs(title = title) +
theme_light()
return(plot)
}
distributionOD(long_OD_time_info, "Distribution of OD600 well readings for a 24h E.coli growth curve")
#| code-fold: true
addcolumnrow <- function(df){
df <- mutate(df, row = substr(df$well, start = 1, stop = 1),
column = substr(df$well, start = 2, stop = length(df$well)) )
#make it see column numbers as discrete variables (not contiuous), needed for graphing
df$column <- factor(df$column, levels = df$column[1:12])
print(df %>% head(3)) #the 2 new columns are there
return(df)
}
long_OD_time_info <- addcolumnrow(long_OD_time_info)
#| code-fold: true
drugconcs <- read_csv("drugconcs/PB9_drugconcs.csv", show_col_types = F)
head(drugconcs, 3) #values in uM or ug/mL
#| code-fold: true
drugconcs <- select(drugconcs, ampconc_uM, pepconc_uM) #remove ug/mL
print(drugconcs)
#| code-fold: true
adddrugconcs <- function(dfgc, dfdc){
dfgc <- dfgc %>%  mutate(amp_uM = case_when(
dfgc$row == "A" ~ dfdc$ampconc_uM[1],
dfgc$row == "B" ~ dfdc$ampconc_uM[2],
dfgc$row == "C" ~ dfdc$ampconc_uM[3],
dfgc$row == "D" ~ dfdc$ampconc_uM[4],
dfgc$row == "E" ~ dfdc$ampconc_uM[5],
dfgc$row == "F" ~ dfdc$ampconc_uM[6],
dfgc$row == "G" ~ dfdc$ampconc_uM[7],
dfgc$row == "H" ~ dfdc$ampconc_uM[8]),
pep_uM = case_when(dfgc$column == 1 ~ dfdc$pepconc_uM[1],
dfgc$column == 2 ~ dfdc$pepconc_uM[2],
dfgc$column == 3 ~ dfdc$pepconc_uM[3],
dfgc$column == 4 ~ dfdc$pepconc_uM[4],
dfgc$column == 5 ~ dfdc$pepconc_uM[5],
dfgc$column == 6 ~ dfdc$pepconc_uM[6],
dfgc$column == 7 ~ dfdc$pepconc_uM[7],
dfgc$column == 8 ~ dfdc$pepconc_uM[8],
dfgc$column == 9 ~ dfdc$pepconc_uM[9],
dfgc$column == 10 ~ dfdc$pepconc_uM[10],
dfgc$column == 11 ~ dfdc$pepconc_uM[11],
dfgc$column == 12 ~ dfdc$pepconc_uM[12])
)
#make these concentrations factors, so the graphs will work properly later!
#(discrete values!)
dfgc$amp_uM   <- factor(dfgc$amp_uM, levels = dfgc$amp_uM[seq(1, 96, by=12)])
dfgc$pep_uM   <- factor(dfgc$pep_uM, levels = na.omit(dfgc$pep_uM[1:12]))
print(dfgc %>% head(3))
return(dfgc)
}
long_OD_time_info <- adddrugconcs(long_OD_time_info, drugconcs)
#| code-fold: true
bgOD <- read_csv("background/camhb_bg_input.csv", show_col_types = F)
head(bgOD)
#| code-fold: true
bgOD <- rename(bgOD, row = ...1)   #fix name of column 1, rename it 'row'
#use pivot longer, so this data can be used with above OD_time data
bgOD <- pivot_longer(bgOD, cols = `1`:`12`,
names_to = "column",
values_to = "OD600")
print(head(bgOD, 3))
#| code-fold: true
bgOD <- mutate(bgOD, well = paste0(row, column))
bgOD[seq(1, 96, by = 12),] #looks good.
#| code-fold: true
range(bgOD$OD600)
long_OD_time_info$well[1:96] == bgOD$well
long_OD_time_info$OD600 <- long_OD_time_info$OD600 - bgOD$OD600
range(long_OD_time_info$OD600)
#| code-fold: true
rowAplot2 <- long_OD_time_info %>%     #testing plots on one row (row A)
filter(row == "A") %>%
ggplot(aes(x = newtime, y = OD600, color = pep_uM)) +
geom_line() +
labs(x = "Time (hours)",
title = "24h growth curve of E.coli PB9 \nat ampicillin concentration 0 and varying peptide concs",
color = "Peptide \nConc. (\u00B5M)") +
geom_point() +
theme_minimal()
print(rowAplot2)
#| code-fold: true
makesinglerowplotpep <- function(df, title){
#no ampicillin row
p1 <- df%>%
filter(amp_uM == 0 & newtime > 1) %>%
ggplot(aes(x = newtime, y = OD600, color = pep_uM)) +
geom_point() +
labs(x = "Time (hours)", color = "Peptide \nConcentration (\u00B5M)",  title = title) +
geom_line()  +
theme_minimal()
return(p1)
}
makesinglerowplotpep(long_OD_time_info,
"24h growth curve of E.coli PB9 \nat ampicillin concentration 0")
makesinglerowplotamp <- function(df, title){
#no peptide column
p2 <- df %>%
filter(pep_uM == 0 & newtime > 1) %>%
ggplot(aes(x = newtime, y = OD600, color = amp_uM)) +
geom_point() +
labs(x = "Time (hours)",
color = "ampicillin \nconc (\u00B5M)",
title = title) +
geom_line() +
theme_minimal()
print(p2)
}
makesinglerowplotamp(long_OD_time_info,
"24h growth curve of E.coli PB9 \nat a peptide concentration of 0")
#| code-fold: true
make_allwellgc <- function(df, title){
allwellplot <- df %>%
filter(newtime > 1) %>%
ggplot(aes(x = newtime, y = OD600)) +
geom_point(color = "blue", size = 0.2) +
geom_line(color = "blue", linewidth = 0.5) +
geom_area(fill = "lightblue") +
labs(x = "Time (hours)", title = title) +
facet_grid(amp_uM ~ pep_uM, scales = "fixed") +
scale_y_continuous(breaks = seq(0, 1.5, 0.5),
sec.axis = sec_axis(~ . ,
name = "Ampicillin Concentration (\u00B5M)",
breaks = NULL, labels = NULL)) +
scale_x_continuous(breaks = seq(0, 24, 4),
sec.axis = sec_axis(~ . ,
name = "Peptide Concentration (\u00B5M)",
breaks = NULL, labels = NULL)) +
theme(
axis.title.x = element_text(size = 12),  # Increase x-axis label
axis.title.y = element_text(size = 12),   # Increase y-axis label
axis.text.x = element_text(size = 4),  # Increase x-axis scale values
axis.text.y = element_text(size = 6),   # Increase y-axis scale values
axis.title.y.right = element_text(size = 12),
axis.title.x.top = element_text(size = 12),
plot.margin = unit(c(1, 1, 1, 1), "cm")
)
return(allwellplot)
}
allwellplot <- make_allwellgc(long_OD_time_info, "Growth curve of checkerboard assay for TEM-1 containing E.coli PB8")
#save plot to put image in quarto file t
ggsave2(plot = allwellplot,
filename = "plots/PB9_allwellplot.jpeg",
width = 24, height = 16, units = "cm")
#| code-fold: true
calculatingarea <- function(data, i){
#use area of a trapezoid equation to determine area between 2 points, then sum them up
height <- lead(data$newtime) - data$newtime
height <- as.numeric(height)  #it was returning it as a difftime object
base1 <- data$OD600
base2 <- lead(data$OD600)
Area <- (base1 + base2)*height/2
Area <- na.omit(Area)
return(sum(Area))
}
#| code-fold: true
wellnums <- unique(long_OD_time_info$well)
areavector <- function(df){
allareas <- c()
for (i in 1:(nrow(df)/49)) {
A <- df %>%
filter(well == wellnums[[i]]) %>%
calculatingarea(i)
allareas <- c(allareas, A)
}
return(round(allareas, 2))
}
allareas <- areavector(long_OD_time_info)
print(allareas[1:10])
#| code-fold: true
#now I will add the area data to the original data frame to do some work with it.
long_OD_time_info <- long_OD_time_info %>%
mutate(area = rep(allareas, 49))
#because area values correspond to the same order as well numbers, can just multiply them to match the same length.
#| code-fold: true
long_OD_time_info %>%
filter(well == "A1") %>%
select(area) %>%
unique() %>%
length()
#| code-fold: true
makeheatmap <- function(df, title){
#first I'm going to change the direction of the ampicillin factor, because I am used to visualizing checkerbaords with (0,0) in the top left corner.
df$amp_uM <- factor(df$amp_uM, levels = rev(unique(df$amp_uM)))
df%>%
ggplot(aes(x = pep_uM, y = amp_uM, fill = area)) +
geom_tile() +
scale_x_discrete(position = "top") +
labs(x = "Peptide Concentration (\u00B5M)",
y = "Ampicillin Concentration (\u00B5M)",
fill = "Area",
title = title) +
theme(
panel.background = element_blank(),  #this removes gray around the edges
plot.background  = element_blank(),
panel.border     = element_blank(),
plot.title = element_text(size = 10)
)
}
PB9_hmap <- makeheatmap(long_OD_time_info,
title = "Heatmap of area under the curve for each well in a Checkerboard \nfor TEM-1 ncontaining E.coli PB9")
#PB9_hmap
#saving image
ggsave2(plot = PB9_hmap, filename = "plots/PB9_hmap.jpeg", width = 12, height = 8, units = "cm")
#| code-fold: true
MG1655_gc <- read_csv("./growthcurvedata/checkerboard_MG1655_amp_EP6_250123_input.csv", show_col_types = F)
names(MG1655_gc)
#| code-fold: true
MG1655_gc <- MG1655_gc[,-2] #remove Temp column because it's useless
checklength_and_NAs(MG1655_gc) #no NAs, all columns are 49 timepoints.
#| code-fold: true
MG1655_gc <- makenewtime(MG1655_gc)  #make newtime column
MG1655_gc <- pivotlong_gc(MG1655_gc) #pivot longer
MG1655_gc <- addcolumnrow(MG1655_gc) #add column and row columns
#| code-fold: true
MG1655drugconcs <- read_csv("drugconcs/MG1655_drugconcs.csv", show_col_types = F) #read in drug concs
head(MG1655drugconcs)
#| code-fold: true
MG1655_gc <- adddrugconcs(MG1655_gc, MG1655drugconcs)  #looks good.
#| code-fold: true
MG1655_gc$OD600 <- MG1655_gc$OD600 - bgOD$OD600
range(MG1655_gc$OD600) #looks good (a little below 0 is fine)
#| code-fold: true
MG1655_gc <- na.omit(MG1655_gc)
#| code-fold: true
makesinglerowplotamp(MG1655_gc,
title = "24h growth curve of E.coli MG1655 control strain \ntreated without peptide")
#| code-fold: true
makesinglerowplotpep(MG1655_gc,
title = "24h growth curve of E.coli MG1655 control strain \ntreated without ampicillin")
#| code-fold: true
MG1655plot <- make_allwellgc(MG1655_gc,
title = "24h Growth curve of Checkerboard assay for MG1655 control strain.")
ggsave2(plot = MG1655plot, filename = "plots/MG1655_allwellplot.jpeg",  width = 24, height = 16, units = "cm")
#| code-fold: true
wellnums <- unique(MG1655_gc$well)
MG1655areas <- areavector(MG1655_gc)
MG1655areas
length(MG1655areas)
range(MG1655areas)  #this all looks good.
MG1655_gc <- MG1655_gc %>%  mutate(area = rep(MG1655areas, 49))   #adding area to df
MG1655_gc %>% head()  #looks good
#| code-fold: true
MG1655_hmap <- makeheatmap(MG1655_gc,
title = "Heatmap of area under the curve \nfor each well in Checkerboard for MG1655 E.coli")
ggsave2(plot = MG1655_hmap, filename = "plots/MG1655_hmap.jpeg", width = 12, height = 8, units = "cm")
